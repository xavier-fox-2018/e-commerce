<!doctype html>
<html lang="en">

<head>
    <link rel="icon" href="http://bonavide.hafrizresa.pro//assets/icon.ico" type="image/x-icon" />

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="google-signin-client_id" content="613470435267-fettiih79rdbotnm660f5jnhrer7rdi3.apps.googleusercontent.com">



    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <script src="https://apis.google.com/js/platform.js" async defer></script>


    <title>Bonafide</title>
</head>

<body>
    <div id="app">

        <header>
            <div class="container">
                <div class="row">
                    <div class="col">
                        <ul class="nav nav-pills">
                            <li class="nav-item dropdown">

                            </li>
                        </ul>
                    </div>
                    <div class="col">
                        <ul class="nav justify-content-end" v-if=" state.isLogin == false">
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="modal" data-target="#loginModal" href="">login</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="modal" data-target="#registerModal" href="#">register</a>
                            </li>
                        </ul>
                        <ul class="nav justify-content-end" v-if="state.isLogin === true">
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="modal" v-on:click="logout" href="">Logout</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="modal" data-target="#cartModal" href="" id="cart">Cart</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="modal" data-target="#TransactionHistory" href="" id="cart">Transaction History</a>
                            </li>
                        </ul>
                    </div>

                </div>
            </div>
            <div class="container-fluid" style="background: url(https://assets.bonanzastatic.com/images/home/bg_thatch.png?1539127379) ">
                <div class="container">
                    <nav class="navbar navbar-expand-lg navbar-light">
                        <div class="pointer">

                            <img src="./assets/Untitled-1.png" v-on:click="reload" alt="">
                        </div>
                        <div class="collapse navbar-collapse justify-content-end">
                            <form class="form-inline my-2 my-lg-0">
                                <input class="form-control mr-sm-2" type="search" v-model="valueSearch" placeholder="Search" aria-label="Search">
                                <button v-on:click="itemsOnsearch" class="btn btn-outline-success my-2 my-sm-0">Search</button>
                            </form>
                        </div>
                    </nav>
                </div>
            </div>

            <div class="container-fluid" style="background-color: #f9faf2">
                <div class="container">
                    <div class="row">
                        <div class="col-md-9">
                            <ul class="nav nav-pills">
                                <li class="nav-item" v-for="value in categories.slice(0,4)">
                                    <a class="nav-link categoryOptions pointer" v-on:click="onClickCategory(value)" role="button"> {{value.name}} </a>
                                </li>
                            </ul>
                        </div>
                        <div class="col-md 3">
                            <ul class="nav nav-pills justify-content-end">
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">More Categories</a>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item pointer" v-for="value in categories" v-on:click="onClickCategory(value)"> {{value.name}} </a>

                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- INI MAIN PAGE  -->
        <main style="background:wheat">
            <div v-if="state.onSearch === false && state.manualSearch == false" class="mb-0 pb-0">
                <div class="container-fluid " style="background: url(https://assets.bonanzastatic.com/images/home/heroes/10_8_18_boy_pumpkin.jpg); width: 100%;
    height: 500px; background-size: cover; background-position: center;  background-repeat: no-repeat;">
                    <div style="position: relative; bottom: -20%">
                        <h1 class="text-center" style="color: white">Find everything but the ordinary</h1>
                        <form class="form-inline my-2 my-lg-0  justify-content-center">
                            <input class="form-control mr-sm-2" v-model="valueSearch" type="search" placeholder="Search" aria-label="Search">
                            <button class="btn btn-outline-success my-2 my-sm-0" v-on:click="itemsOnsearch">Search</button>
                        </form>
                    </div>
                </div>

                <div class="container" style="position: relative; top: -50px; margin-bottom: -79px">
                    <div class="jumbotron text-center p-2 mb-0" style="background-color: #3e4f59; color: white">
                        <p> Sellers who’ve embraced social media are creating new opportunities that totally bypass traditional
                            sales channels.
                        </p>
                        <p> It’s about good selling – using all the tools that are available to you today</p>
                    </div>
                    <div class="jumbotron text-center p-2">
                        <div id="carouselExampleSlidesOnly" class="carousel slide" data-ride="carousel">
                            <div class="carousel-inner">
                                <div class="carousel-item active">
                                    <img class="d-block w-100" src="./assets/1.jpeg" alt="First slide">
                                </div>
                                <div class="carousel-item">
                                    <img class="d-block w-100" src="./assets/pexels-photo-793012.jpeg" alt="Second slide">
                                </div>
                                <div class="carousel-item">
                                    <img class="d-block w-100" src="./assets/pexels-photo-694740.jpeg" alt="Third slide">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid" style="margin-top:80px">

                <hr style="height: 6px;
                background: url(http://ibrahimjabbari.com/english/images/hr-11.png) repeat-x 0 0;
                border: 0;">
            </div>

            <div class="container pt-5">
                <div class="row">
                    <div class="col-md-3">
                        <p v-if="state.onSearch === true">home >>{{items[0].category.name}}</p>
                        <div class="jumbotron p-2 text-center">
                            <p v-if="!searchOnPage">Narrow your results {{items.length}} items found</p>
                            <p v-if="searchOnPage">Narrow your results {{searchResponsive.length}} items found</p>
                            <form class="">
                                <input class="form-control mr-sm-2" type="search" v-model="searchOnPage" placeholder="Search" aria-label="Search">
                            </form>
                        </div>
                    </div>

                    <div class="col-md-9">
                        <div class="row">
                            <div class="col-md-6" v-if="state.onSearch === true">
                                <b>
                                    <i>Your Selections:</b>
                                <a href="">Category "{{items[0].category.name}}"</a>
                                </i>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col pt-2 mb-2" v-for="value in items" v-if="!searchOnPage">
                                <div class="card" style="width: 15rem; min-height: 25rem;">

                                    <div class="pointer" data-toggle="modal" data-target="#detailModal" v-on:click="itemDetail(value)">
                                        <img class="card-img-top" style="max-height: 200px" v-bind:src="value.picture" alt="Card image cap">
                                        <div class="card-body ">
                                            <p class="card-text">{{filterTextLength(value.name)}}</p>
                                            <p>${{value.price}}</p>

                                        </div>

                                    </div>
                                    <div class="card-footer">

                                        <button data-toggle="modal" v-bind:data-target="cartAuth" class="btn btn-primary" v-on:click="addProductToCart(value)"> addtocart</button>
                                    </div>
                                </div>
                            </div>


                            <div class="col pt-2 mb-2" v-for="value in searchResponsive" v-if="searchOnPage">
                                <div class="card" style="width: 15rem; min-height: 25rem;">

                                    <div class="pointer" data-toggle="modal" data-target="#detailModal" v-on:click="itemDetail(value)">
                                        <img class="card-img-top" style="max-height: 200px" v-bind:src="value.picture" alt="Card image cap">
                                    </div>
                                    <div class="card-body ">
                                        <p class="card-text">{{filterTextLength(value.name)}}</p>
                                        <p>${{value.price}}</p>
                                    </div>
                                    <div class="card-footer">
                                            <button data-toggle="modal" v-bind:data-target="cartAuth" class="btn btn-primary" v-on:click="addProductToCart(value)"> addtocart</button>
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cart fModal -->
            <div class="modal fade" id="cartModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Your Cart</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th scope="col">Name</th>
                                        <th scope="col">QTY</th>
                                        <th scope="col">Sub Total</th>
                                        <th scope="col">Option</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="value in cart">
                                        <td>{{value.name}}</td>
                                        <td>{{value.qty}}</td>
                                        <td>${{value.price * value.qty}}</td>
                                        <td>
                                            <a v-on:click="onclickDeleteCart(value)"> delete</a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">TOTAL</td>
                                        <td>${{totalCart}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" v-on:click="onClickCheckOut">Checkout</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TRANSACTION HISTORY MODAL -->
            <div class="modal fade" id="TransactionHistory" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Your Transaction History</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <table class="table table-bordered" v-for="value in paidItems">
                                <thead>
                                    <tr>
                                        <th scope="col">Name</th>
                                        <th scope="col">QTY</th>
                                        <th scope="col">Sub Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="item in value.items">
                                        <td>{{item.name}}</td>
                                        <td>{{item.qty}}</td>
                                        <td style="color: red">${{item.price * item.qty}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LOGIN MODAL -->
            <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Login</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="form-group">
                                    <label for="exampleInputEmail1">Email address</label>
                                    <input v-model="login.email" type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter email">
                                    <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
                                </div>
                                <div class="form-group">
                                    <label for="exampleInputPassword1">Password</label>
                                    <input v-model="login.password" type="password" class="form-control" id="exampleInputPassword1" placeholder="Password">
                                </div>
                                <button v-on:click="loginUser" type="submit" class="btn btn-primary">Signin</button>
                                <template>
                                    <div id="google-signin-button">
                                    </div>
                                </template>
                                <div v-if="state.successAlert === true" class="alert alert-success">
                                    <strong>Loged in</strong>
                                </div>
                                <div v-if="state.failAlert === true" class="alert alert-danger">
                                    <strong>Wrong username / password</strong>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- register modal -->
            <div class="modal fade" id="registerModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">register</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form>

                                <div class="form-group">
                                    <label for="inputEmail4">Name</label>
                                    <input required type="text" v-model="register.name" class="form-control" placeholder="Name">
                                </div>
                                <div class="form-group">
                                    <label for="inputEmail4">Email</label>
                                    <input required type="email" v-model="register.email" class="form-control" placeholder="Email">
                                </div>
                                <div class="form-group">
                                    <label for="inputPassword4">Password</label>
                                    <input required type="password" v-model="register.password" class="form-control" id="inputPassword4" placeholder="Password">
                                </div>
                                <div v-if="state.registerStatus == 'success'" class="alert alert-success">
                                    <strong>Success!</strong> Please go to login section
                                </div>
                                <div v-if="state.registerStatus == 'fail'" class="alert alert-danger">
                                    <strong>Fail</strong> please check your data or use another email.
                                </div>
                                <button type="submit" v-on:click="registerUser" class="btn btn-primary">Register</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- DETAIL MODAL -->
            <div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel" style="text-align: center">{{detailItem.name}}</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <img v-bind:src="detailItem.picture" alt="">
                        <div class="modal-body">
                            <p style="text-align: center">
                                {{detailItem.description}}
                            </p>
                        </div>
                    </div>
                </div>
            </div>


            <footer>

                <div class="container-fluid justify-content-center text-center" style="color: white; background-image: url(https://assets.bonanzastatic.com/images/home/bg_testimonials.jpg?1536090296); height: 100px">
                    <div style="position: relative; top: 50%">
                        <div class="col text-center">
                            <p>© 2018 Bonafide. All Rights Reserved | Cookies and Tracking | Privacy Policy | Terms of Use</p>
                        </div>
                    </div>
                </div>

            </footer>
    </div>
    <script type='text/javascript' data-cfasync='false'>window.purechatApi = { l: [], t: [], on: function () { this.l.push(arguments); } }; (function () { var done = false; var script = document.createElement('script'); script.async = true; script.type = 'text/javascript'; script.src = 'https://app.purechat.com/VisitorWidget/WidgetScript'; document.getElementsByTagName('HEAD').item(0).appendChild(script); script.onreadystatechange = script.onload = function (e) { if (!done && (!this.readyState || this.readyState == 'loaded' || this.readyState == 'complete')) { var w = new PCWidget({c: 'e974e918-00ee-464f-b0c6-28ba99a0a5bf', f: true }); done = true; } }; })();</script>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
        //JAVA SCRIPT
        function onSignIn(googleUser) {
            var id_token = googleUser.getAuthResponse().id_token;
            // console.log(id_token)
            axios.post('http://35.200.243.58:3000/users/login-google', { token: id_token })
                .then(data => {
                    console.log(data)
                    localStorage.setItem('token', data.data.token)
                })
                .catch(err => {
                })
        }

        //component


        Vue.component('success-alert', {

        })

        // VUE JS
        new Vue({
            el: '#app',
            data: {
                categories: [],
                cartAuth: '#loginCart',
                items: [],
                detailItem: '',
                paidItems: [],
                valueSearch: '',
                cart: [],
                idCart: '',
                register: {
                    name: '',
                    email: '',
                    password: '',
                    picture: null
                },
                login: {
                    email: '',
                    password: ''
                },
                searchOnPage: '',
                state: {
                    registerStatus: '',
                    onSearch: false,
                    manualSearch: false,
                    isLogin: null,
                    successAlert: null,
                    failAlert: null
                }
            },
            methods: {
                reload: function () {
                    location.reload()
                },
                itemDetail: function (input) {
                    this.detailItem = input

                },
                itemsOnsearch: function (e) {
                    e.preventDefault()
                    axios.post('http://35.200.243.58:3000/users/search-items', {
                        data: this.valueSearch
                    })
                        .then(data => {
                            console.log(data.data)
                            this.items = data.data
                            this.state.manualSearch = true
                        })
                },
                onSignIn(user) {
                    const id_token = user.getAuthResponse().id_token

                    axios.post('http://35.200.243.58:3000/users/login-google', { token: id_token })
                        .then(data => {
                            console.log(data)
                            localStorage.setItem('token', data.data.token)
                            this.state.isLogin = true
                            this.cartAuth = '#cartModal'
                            this.state.successAlert = true
                        })
                        .catch(err => {
                        })
                },

                onClickCategory: function (input) {
                    axios.post('http://35.200.243.58:3000/item-by-category', {
                        category: input._id
                    })
                        .then(data => {
                            this.items = data.data
                            this.state.onSearch = true
                        })
                        .catch(err => {
                            console.log(err)
                        })


                },

                logout: function () {
                    localStorage.removeItem('token')
                    var auth2 = gapi.auth2.getAuthInstance();
                    auth2.signOut().then(function () {
                        console.log('User signed out.');
                    });

                    this.state.isLogin = false
                    this.cartAuth = '#loginModal'
                    this.state.failAlert = null
                    this.state.successAlert = null
                },

                loginUser(event) {
                    event.preventDefault()
                    axios.post('http://35.200.243.58:3000/users/login', this.login)
                        .then(data => {
                            // console.log(data)
                            if (data.data.role == 'Admin') {
                                localStorage.setItem('token', data.data.token)
                                window.location.href = 'http://bonavide.hafrizresa.pro/adminpage.html'
                            } else {
                                localStorage.setItem('token', data.data.token)
                                this.state.isLogin = true
                                this.cartAuth = '#cartModal'
                                this.state.successAlert = true
                                this.state.failAlert = null
                            }
                        })
                        .catch(err => {
                            if (err) {
                                this.state.failAlert = true
                                this.state.successAlert = null
                                console.log('please check your email/password')
                            }
                        })
                },

                registerUser(event) {
                    event.preventDefault()
                    axios.post('http://35.200.243.58:3000/users/signup', this.register)
                        .then(data => {
                            if (typeof data.data === 'string') {
                                this.state.registerStatus = 'fail'
                            } else {
                                this.state.registerStatus = 'success'
                            }
                        })
                        .catch(err => {
                            console.log(err)
                        })
                },
                filterTextLength: function (input) {
                    if (input.length >= 39) {
                        let filtered = input.slice(0, 35)
                        return filtered + '. . .'
                    } else {
                        return input
                    }
                },
                addProductToCart: function (input) {
                    if (this.state.isLogin == false) {
                        this.cartAuth = '#loginModal'
                    } else {
                        this.cartAuth = '#cartModal'
                        let cart = {
                            token: localStorage.getItem('token'),
                            item: {
                                id: input.id
                            }
                        }

                        axios.post('http://35.200.243.58:3000/cart/add', cart)
                            .then(data => {
                                this.idCart = data.data[0]._id
                                let cart = data.data[0].items
                                // console.log(data)
                                let result = []

                                cart.forEach(element => {
                                    let filtered = cart.filter(val => {
                                        return element._id === val._id
                                    })
                                    // console.log(' ini filtered', filtered)
                                    let selector = result.filter(val => {
                                        return val._id === element._id
                                    })
                                    // console.log(' ini selector', selector)

                                    if (selector.length == 0) {
                                        let temp = element
                                        temp.qty = filtered.length
                                        result.push(temp)
                                    }
                                })
                                this.cart = result

                            })
                            .catch(err => {
                                console.log(err)
                            })
                    }
                },
                onclickDeleteCart: function (input) {
                    console.log(input)
                    axios.delete('http://35.200.243.58:3000/cart/delete', {
                        data: {
                            token: localStorage.getItem('token'),
                            idCart: this.idCart,
                            idItem: input._id
                        }
                    })
                        .then(data => {
                            console.log(data)
                            if (data.data.length == 0) {
                                this.cart = []
                            } else {

                                let cart = data.data[0].items
                                let result = []

                                cart.forEach(element => {
                                    let filtered = cart.filter(val => {
                                        return element._id === val._id
                                    })
                                    let selector = result.filter(val => {
                                        return val._id === element._id
                                    })

                                    if (selector.length == 0) {
                                        let temp = element
                                        temp.qty = filtered.length
                                        result.push(temp)
                                    }
                                })
                                this.cart = result
                            }
                        })
                        .catch(err => {
                            console.log(err)
                        })
                },

                onClickCheckOut: function () {
                    // console.log(this.idCart)
                    axios.post('http://35.200.243.58:3000/cart/submit-checkout', {
                        token: localStorage.getItem('token'),
                        idCart: this.idCart
                    })
                        .then(data => {
                            return axios.post('http://35.200.243.58:3000/cart/paid', {
                                token: localStorage.getItem('token')
                            })
                        })
                        .then(data => {
                            console.log(data)
                            this.cart = []
                            let paid = data.data
                            // console.log(paid)
                            let result = []
                            paid.forEach(element => {
                                let object = {
                                    items: []
                                }
                                element.items.forEach(val => {

                                    let filtered = element.items.filter(item => {
                                        return val._id === item._id
                                    })
                                    console.log(filtered)
                                    let selector = object.items.filter(item => {
                                        return val._id == item._id
                                    })
                                    if (selector.length == 0) {
                                        let temp = val
                                        temp.qty = filtered.length
                                        object.items.push(temp)
                                    }
                                })
                                result.push(object)
                            })
                            this.paidItems = result
                        })
                        .catch(err => {
                            console.log(err)
                        })
                }
            },
            computed: {
                searchResponsive: function () {
                    let result = []
                    let data = this.items.filter((val, index, arr) => {
                        if (val.name.toLowerCase().includes(this.searchOnPage.toLowerCase()) == true) {
                            return val
                        }
                    })
                    return data
                },
                totalCart: function () {
                    let total = 0
                    this.cart.forEach(element => {
                        total += Number(element.price) * Number(element.qty)
                    })
                    return total
                }
            },
            watch: {},
            created: function () {
                console.log('vue has been created')
            },
            mounted: function () {
                this.state.successAlert = null
                this.state.failAlert = null
                gapi.signin2.render('google-signin-button', {
                    onsuccess: this.onSignIn
                })


                // check login
                if (localStorage.getItem('token') == undefined) {
                    this.state.isLogin = false
                    this.cartAuth = '#loginModal'
                } else {
                    this.state.isLogin = true
                    this.cartAuth = '#cartModal'

                    //mount history
                    axios.post('http://35.200.243.58:3000/cart/paid', {
                        token: localStorage.getItem('token')
                    })
                        .then(data => {
                            let paid = data.data
                            // console.log(paid)
                            let result = []
                            paid.forEach(element => {
                                let object = {
                                    items: []
                                }
                                element.items.forEach(val => {

                                    let filtered = element.items.filter(item => {
                                        return val._id === item._id
                                    })
                                    let selector = object.items.filter(item => {
                                        return val._id == item._id
                                    })
                                    if (selector.length == 0) {
                                        let temp = val
                                        temp.qty = filtered.length
                                        object.items.push(temp)
                                    }
                                })
                                result.push(object)
                            })
                            this.paidItems = result
                        })
                        .catch(err => {
                            console.log(err)
                        })

                    // mount cart
                    axios.post('http://35.200.243.58:3000/cart/unpaid', {
                        token: localStorage.getItem('token')
                    })
                        .then(data => {
                            this.idCart = data.data[0]._id
                            let cart = data.data[0].items
                            let result = []

                            cart.forEach(element => {
                                let filtered = cart.filter(val => {
                                    return element._id === val._id
                                })
                                let selector = result.filter(val => {
                                    return val._id === element._id
                                })

                                if (selector.length == 0) {
                                    let temp = element
                                    temp.qty = filtered.length
                                    result.push(temp)
                                }
                            })
                            this.cart = result
                        })
                        .catch(err => {
                            console.log(err)
                        })
                }
                // get all info
                axios.get('http://35.200.243.58:3000')
                    .then(data => {
                        this.categories = data.data.category
                        this.items = data.data.item
                    })
                console.log('vue has been mounted')
            }
        })

    </script>
</body>

</html>